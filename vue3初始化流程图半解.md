---
theme: channing-cyan
---
# å‰è¨€
  å¤§å®¶å¥½ï¼æˆ‘æ˜¯ä¹¾é˜³ï¼Œæœ€è¿‘åœ¨é¢è¯•ï¼Œå‘ç°å¤–é¢çš„é¢è¯•å®˜éƒ½å­¦èªæ˜äº†ï¼Œéƒ½ä¸çˆ±é—®ä½ å“åº”å¼äº†ï¼Œå–œæ¬¢é—®ä½ vue3çš„åˆå§‹åŒ–çš„æµç¨‹ã€‚æå¾—æˆ‘ä¸å¾—ä¸ğŸ§ä¸€ä¸‹å­
  ### è°ƒè¯•ç¯å¢ƒ
  
```js
    git clone https://github.com/vuejs/core.git
```
æ‹‰å–ä¸‹æ¥ä¹‹åpnpmå®‰è£…ä¸€ä¸‹
æ‰§è¡Œ

```js
pnpm serve
```
ç„¶åæ‰“å¼€

```js
http://localhost:55018/packages/vue/examples/composition/todomvc
```
å°±æ˜¯æˆ‘ä»¬å–œé—»ä¹è§çš„todosï¼Œæ‰“å¼€æˆ‘ä»¬çš„å¼€å‘è€…è°ƒè¯•å™¨

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/405c943bff1149efbf1a74b99e5a5d28~tplv-k3u1fbpfcp-watermark.image?)
å¦‚æœä¸å‡ºæ„å¤–çš„åœ¨93è¡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªéå¸¸ç†Ÿæ‚‰çš„ä¸œè¥¿ *createApp*,é‚£è¿™é‡Œå°±æ˜¯åˆå§‹åŒ–çš„å¼€å§‹ï¼Œæˆ‘ä»¬æ‰“ä¸Šæ–­ç‚¹åˆ·æ–°æˆ‘ä»¬çš„ç½‘é¡µè¿›å…¥æ–­ç‚¹ï¼Œåœ¨è¿›å…¥ä¸‹ä¸€æ­¥å°±ä¼šè¿›å…¥æˆ‘ä»¬çš„**runtime-dom/src/index.ts**

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/73775850256f473893454258a35a1691~tplv-k3u1fbpfcp-watermark.image?)

å°±ä¼šçœ‹åˆ°æˆ‘ä»¬createAppå‡½æ•°ï¼Œå¯ä»¥ğŸ‰ä¸€ä¸‹äº†ï¼Œèµ·ç æˆ‘ä»¬æ‰¾åˆ°äº†å…¥å£ï¼Œæ¥ä¸‹æ¥å°±æ˜¯çœ‹è°ƒç”¨æ ˆçœ‹çœ‹è¿™ä¸ªå‡½æ•°æ‰§è¡Œäº†ä»€ä¹ˆã€‚
æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹ä¸‹ä¸€æ­¥ï¼Œå¾ˆç›´æ¥çš„çœ‹è°ƒç”¨ï¼Œå…¶ä»–æˆ‘ä»¬ä¸å…³å¿ƒ

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ad4f1f1239b4b269441adabfa5647e0~tplv-k3u1fbpfcp-watermark.image?)

è¿™é‡Œæ¸…æ™°çš„çœ‹åˆ°æˆ‘ä»¬è°ƒç”¨äº†ensureRendererå‡½æ•°ï¼Œç»“åˆcreateAppæºç 

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc276071825c42b083122e6ca70fbc5a~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥å‘ç°å…¶å®createAppæ˜¯å€ŸåŠ©äº†è¿™ä¸ªå‡½æ•°å»åˆ›å»ºäº†ä¸€ä¸ªappï¼Œåœ¨ä¸‹é¢å°±åˆ°mountæŒ‚è½½äº†ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥è¿›å…¥ensureRendererå»çœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/96ebaf558e0846d29fa7f5bba1019332~tplv-k3u1fbpfcp-watermark.image?)

è¿™ä¸ªå‡½æ•°é‡Œé¢æˆ‘ä»¬çœ‹åˆ°äº†rendererå¹¶ä¸”åšäº†é€»è¾‘åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªrendererï¼Œæ—¢ç„¶æ˜¯åœ¨æŒ‚è½½ä¹‹å‰é‚£ä¹ˆè¿™ä¸ªåº”è¯¥å°±æ˜¯æ¸²æŸ“å™¨ï¼ˆæˆ‘ç™¾åº¦çš„ï¼‰ï¼Œä¸€å¼€å§‹æˆ‘ä»¬æ˜¯æ²¡æœ‰æ¸²æŸ“å™¨çš„ï¼Œé‚£ä¹ˆä»–å°±ä¼šå»åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ï¼Œæ¸²æŸ“å™¨æŠŠæˆ‘ä»¬çš„è™šæ‹Ÿdomæ¸²æŸ“æˆçœŸå®çš„domè¿™ä¸ªè¿‡ç¨‹å«åšæŒ‚è½½ï¼Œæ¸²æŸ“å™¨æ€ä¹ˆçŸ¥é“æŠŠçœŸå®domæŒ‚è½½åˆ°å“ªé‡Œå‘¢ï¼Ÿé‚£å°±æ˜¯ä¼ å…¥ä¸€ä¸ªæŒ‚è½½ç‚¹ï¼Œæ¸²æŸ“å™¨æ¥æ”¶ä¸€ä¸ªæŒ‚è½½ç‚¹ä½œä¸ºå‚æ•°ï¼Œç”¨æ¥æŒ‡å®šå…·ä½“æŒ‚è½½çš„ä½ç½®ã€‚é‚£å°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹ä»£ç é‡Œé¢çš„*app.mount('#app')* è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼Œå…¶å®ä»–æ¥æ”¶çš„æŒ‚è½½ç‚¹å…¶å®æ˜¯ä¸€ä¸ªçœŸå®domï¼ŒæŠŠè¿™ä¸ªdomä½œä¸ºå®¹å™¨æ”¾å…¥æˆ‘ä»¬éœ€è¦æ¸²æŸ“çš„å†…å®¹ã€‚

  é‚£åˆ°ç°åœ¨æ¥è¯´æµç¨‹å°±å¼€å§‹æ¸…æ™°äº†ï¼ŒcreateAppå…¶å®å°±æ˜¯åˆ›å»ºä¸€ä¸ªrendererå¹¶ä¸”æ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„å®¹å™¨æ‰§è¡Œæ¸²æŸ“ã€‚
  ### createRenderer
  æ¥ä¸‹æ¥æˆ‘ä»¬å°±å»çœ‹çœ‹rendereræ˜¯æ€ä¹ˆä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬æŠŠæ–­ç‚¹æ‰“åˆ°
  
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a54427f508d24c1f80a2afcfe6b979fb~tplv-k3u1fbpfcp-watermark.image?)

ç„¶åå‘ç°ä»–åˆè¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œæ²¡äº‹æˆ‘ä»¬æ¥ç€èµ°ï¼Œç„¶åæˆ‘å°±è¿›å…¥åˆ°äº†ä¸€ä¸ªå¾ˆé•¿çš„æ–‡ä»¶é‡Œé¢äº†ï¼Œæ²¡å…³ç³»æˆ‘ä»¬ä¸ç”¨ç†è§£å…¶ç›¸å…³çš„å®ç°ï¼Œåªè¦çœ‹ä»–returnçš„ä¸œè¥¿å°±å¥½äº†ï¼Œæˆ‘ä»¬ä¼šåœ¨2359è¡Œçœ‹åˆ°

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af23e7a064274d06b7350105544dc832~tplv-k3u1fbpfcp-watermark.image?)
åˆå‡ºç°äº†ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨2362è¡Œæ‰“ä¸Šæ–­ç‚¹ï¼Œçœ‹çœ‹è¿™ä¸ªä¸œè¥¿è¿”å›äº†ä¸ªå•¥

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7209f81da4f04176be0f754501f2439d~tplv-k3u1fbpfcp-watermark.image?)
æˆ‘ä»¬å¾€ä¸‹æ‹‰ä¼šçœ‹åˆ°å¾ˆå¤šæˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„æ–¹æ³•useï¼Œmixinç­‰

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/47b1cdef7da74d50918d39452ca225e2~tplv-k3u1fbpfcp-watermark.image?)
é‚£ä¹ˆæ¯«æ— ç–‘é—®è¿™é‡Œæ‰æ˜¯åˆ›å»ºæˆ‘ä»¬appå®ä¾‹çš„åœ°æ–¹ï¼Œå¥½å®¶ä¼™ã€‚ã€‚ã€‚
ä½†æ˜¯æ³¨æ„âš ï¸ä¸€ä¸‹æˆ‘ä»¬æ­¤è¡Œçš„ç›®çš„åªæ˜¯ä¸ºäº†æ‘¸æ¸…vue3çš„åˆå§‹åŒ–è¿‡ç¨‹åˆ°åº•ç»å†äº†ä»€ä¹ˆï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸è¦è·‘åï¼Œæ—¢ç„¶æˆ‘ä»¬æ‰¾åˆ°äº†åˆ›å»ºappå®ä¾‹çš„åœ°æ–¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½æ‰¾åˆ°å…³é”®çš„mountï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1066248ba73a4d60afe71d8313e48e72~tplv-k3u1fbpfcp-watermark.image?)
è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†mountæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨286æ‰“ä¸Šæ–­ç‚¹ï¼Œä»–è¿™é‡Œå†™å¾—å¾ˆæ˜æ˜¾äº†æ˜¯å¦æŒ‚è½½ï¼Œæˆ‘ä»¬æ—¢ç„¶æ˜¯ç¬¬ä¸€æ¬¡è¿›æ¥çš„é‚£ä¹ˆä¸€å®šæ²¡æœ‰æŒ‚è½½ï¼Œè¿›æ¥ç„¶åçœ‹åˆ°vnodeè¿™ä¹ˆå¤šå¹´äº†å¤§å®¶åº”è¯¥éƒ½çŸ¥é“äº†vnodeå°±æ˜¯è™šæ‹Ÿdomï¼Œè¿™é‡Œåº”è¯¥æ˜¯åˆ›å»ºè™šæ‹Ÿdomçš„åœ°æ–¹,ç„¶åæˆ‘ä»¬ä¼šåˆä¸€æ¬¡æ¥åˆ°åˆ†å‰å£

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f786b48171b346d1b5f01152216bfb38~tplv-k3u1fbpfcp-watermark.image?)
è¿™é‡Œåº”è¯¥æ˜¯åˆ¤æ–­ä¸€ä¸‹æˆ‘ä»¬æ˜¯ä»€ä¹ˆæ¸²æŸ“æ¨¡å¼ï¼Œæˆ‘ä»¬å®¢æˆ·ç«¯æ¸²æŸ“åº”è¯¥èµ°çš„renderï¼Œè¿›å…¥renderå‡½æ•°

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82aec20ef5c94093ae57defe88c36522~tplv-k3u1fbpfcp-watermark.image?)
è¿™é‡Œæˆ‘ç›´æ¥æ­¥å…¥äº†ï¼Œå¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬ä¸Šé¢çš„æƒ³æ³•ä¸€è‡´ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥div#appï¼Œè¿™ä¸ªpatchå°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿdomè½¬çœŸå®domå¹¶ä¸”è¿½åŠ åˆ°å®¿ä¸»#appä¸­ã€‚
    è‡³æ­¤å…¶å®æ•´ä¸ªvue3å®ä¾‹åˆ›å»ºï¼ŒæŒ‚è½½çš„æµç¨‹ï¼Œæˆ‘ä»¬å…¶å®å·²ç»æ‘¸æ¸…æ¥šäº†ï¼Œå…·ä½“å®ç°æœ‰å¾…æˆ‘å»æ·±ç©¶ã€‚